<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Smart Irrigation Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>body{font-family:system-ui;margin:2rem} .tile{padding:1rem;border:1px solid #ddd;border-radius:8px;display:inline-block;margin-right:1rem}</style>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Smart Irrigation â€“ Live</h1>
  <div class="tile"><b>Moisture:</b> <span id="m">--</span>%</div>
  <div class="tile"><b>Pump:</b> <span id="p">--</span></div>
  <div class="tile"><b>Updated:</b> <span id="t">--</span></div>

  <canvas id="chart" width="600" height="240"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // fill with your Firebase config
    const firebaseConfig = { apiKey:"YOUR_KEY", databaseURL:"https://your-project-id-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const deviceId = "node-001";

    const mEl = document.getElementById('m'), pEl = document.getElementById('p'), tEl = document.getElementById('t');

    const ctx = document.getElementById('chart').getContext('2d');
    const data = { labels: [], datasets: [{ label: 'Moisture %', data: [] }]};
    const chart = new Chart(ctx, { type: 'line', data, options:{ animation:false, scales:{ y:{ min:0,max:100 }}} });

    db.ref(`/devices/${deviceId}/latest`).on('value', snap => {
      const v = snap.val() || {};
      mEl.textContent = v.moisture ?? '--';
      pEl.textContent = v.pumpState ? 'ON' : 'OFF';
      tEl.textContent = new Date((v.ts||0)*1000).toLocaleTimeString();
      const ts = new Date().toLocaleTimeString();
      data.labels.push(ts); data.datasets[0].data.push(v.moisture||0);
      if (data.labels.length>60){ data.labels.shift(); data.datasets[0].data.shift(); }
      chart.update();
    });
  </script>
</body>
</html>

